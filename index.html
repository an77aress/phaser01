<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ejemplo Juego DIPTA</title>
  <style>
    body { margin: 0; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <script>
    class MenuScene extends Phaser.Scene {
      constructor() {
        super({ key: 'MenuScene' });
      }
      preload() {
        this.load.image('sky', 'https://labs.phaser.io/assets/skies/sky4.png');
      }
      create() {
        this.add.image(400, 300, 'sky');
        this.add.text(
          400,
          220,
          'Prueba de juego para DIPTA',
          { fontSize: '28px', fill: '#fff', align: 'center', wordWrap: { width: 700 } }
        ).setOrigin(0.5);
        this.add.text(
          400,
          280,
          'Presiona ESPACIO para jugar',
          { fontSize: '32px', fill: '#fff' }
        ).setOrigin(0.5);
        // Descripción tech stack en letras más pequeñas
        this.add.text(
          400,
          340,
          'Tech Stack:\n- Phaser 3.0 como libreria para crear juegos\n- Visual Studio Code con Copilot para codifcar con IA\n- render.com para publicar el sitio',
          { fontSize: '16px', fill: '#fff', align: 'center', wordWrap: { width: 700 } }
        ).setOrigin(0.5);
        this.input.keyboard.once('keydown-SPACE', () => {
          this.scene.start('GameScene');
        });
      }
    }

    class EndScene extends Phaser.Scene {
      constructor() {
        super({ key: 'EndScene' });
      }
      preload() {
        this.load.image('sky', 'https://labs.phaser.io/assets/skies/sky4.png');
      }
      create() {
        this.add.image(400, 300, 'sky');
        this.add.text(
          400,
          250,
          '¡Has terminado!',
          { fontSize: '48px', fill: '#fff', align: 'center' }
        ).setOrigin(0.5);
        this.add.text(
          400,
          320,
          'Presiona ESPACIO para volver al menú',
          { fontSize: '28px', fill: '#fff', align: 'center' }
        ).setOrigin(0.5);
        this.input.keyboard.once('keydown-SPACE', () => {
          this.scene.start('MenuScene');
        });
      }
    }

    class GameScene extends Phaser.Scene {
      constructor() {
        super({ key: 'GameScene' });
      }
      preload() {
        this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
        this.load.image('sky', 'https://labs.phaser.io/assets/skies/sky4.png');
        this.load.image('star', 'https://labs.phaser.io/assets/demoscene/star.png');
        this.load.spritesheet('dude',
          'https://labs.phaser.io/assets/sprites/dude.png',
          { frameWidth: 32, frameHeight: 48 }
        );
      }
      create() {
        this.add.image(400, 300, 'sky');
        const platforms = this.physics.add.staticGroup();
        platforms.create(400, 580, 'ground').setScale(2).refreshBody();
        platforms.create(600, 400, 'ground');
        platforms.create(50, 250, 'ground');
        platforms.create(750, 220, 'ground');

        this.player = this.physics.add.sprite(100, 450, 'dude');
        this.player.setBounce(0.2);
        this.player.setCollideWorldBounds(true);

        this.anims.create({
          key: 'left',
          frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
          frameRate: 10,
          repeat: -1
        });
        this.anims.create({
          key: 'turn',
          frames: [{ key: 'dude', frame: 4 }],
          frameRate: 20
        });
        this.anims.create({
          key: 'right',
          frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
          frameRate: 10,
          repeat: -1
        });

        this.physics.add.collider(this.player, platforms);

        // Crear las estrellas
        this.stars = this.physics.add.group({
          key: 'star',
          repeat: 11,
          setXY: { x: 12, y: 0, stepX: 70 }
        });
        this.stars.children.iterate(function (child) {
          child.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
        });
        this.physics.add.collider(this.stars, platforms);

        // Inicializar marcador
        this.score = 0;
        this.scoreText = this.add.text(16, 16, 'Estrellas: 0', { fontSize: '32px', fill: '#fff' });

        // Hacer que el jugador pueda recoger las estrellas
        this.physics.add.overlap(this.player, this.stars, (player, star) => {
          star.disableBody(true, true);
          this.score += 1;
          this.scoreText.setText('Estrellas: ' + this.score);

          // Si ya no quedan estrellas, pasar a la escena final
          if (this.stars.countActive(true) === 0) {
            this.time.delayedCall(500, () => {
              this.scene.start('EndScene');
            });
          }
        }, null, this);

        this.cursors = this.input.keyboard.createCursorKeys();
        this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

        // Variables para touch
        this.touchLeft = false;
        this.touchRight = false;
        this.touchJump = false;

        // Detectar touch en pantalla
        this.input.on('pointerdown', (pointer) => {
          // Dividir la pantalla en 3 zonas: izquierda, centro (salto), derecha
          if (pointer.x < this.sys.game.config.width / 3) {
            this.touchLeft = true;
          } else if (pointer.x > 2 * this.sys.game.config.width / 3) {
            this.touchRight = true;
          } else {
            this.touchJump = true;
          }
        }, this);

        this.input.on('pointerup', (pointer) => {
          this.touchLeft = false;
          this.touchRight = false;
          this.touchJump = false;
        }, this);
      }
      update() {
        const player = this.player;
        const cursors = this.cursors;
        const velocidad = 160 * 1.4; // 224

        // Movimiento lateral (teclado o touch)
        if (cursors.left.isDown || this.touchLeft) {
          player.setVelocityX(-velocidad);
          player.anims.play('left', true);
        } else if (cursors.right.isDown || this.touchRight) {
          player.setVelocityX(velocidad);
          player.anims.play('right', true);
        } else {
          player.setVelocityX(0);
          player.anims.play('turn');
        }
        // Saltar con barra espaciadora o touch (zona central)
        if ((this.spaceKey.isDown || this.touchJump) && player.body.touching.down) {
          player.setVelocityY(-330 * 1.1); // -363
        }
      }
    }

    // Cambia la gravedad global en la configuración:
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      backgroundColor: '#87CEEB',
      physics: {
        default: 'arcade',
        arcade: {
          gravity: { y: 300 * 1.2 }, // 360, aumenta la gravedad un 20%
          debug: false
        }
      },
      scene: [MenuScene, GameScene, EndScene]
    };

    const game = new Phaser.Game(config);
  </script>
</body>
</html>
